# SSL Configuration
server {
    listen 443 ssl http2 default_server;
    listen [::]:443 ssl http2 default_server;
    
    root /var/www/projects;
    index index.html;
    server_name _;
    
    # SSL certificate paths
    ssl_certificate /etc/ssl/private/server.crt;
    ssl_certificate_key /etc/ssl/private/server.key;
    
    # SSL security settings
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    
    # HSTS (optional - uncomment if needed)
    # add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # Favicon handling
    location /favicon.ico {
        return 204;
        access_log off;
        log_not_found off;
    }
    
    # Health check endpoint
    location /nginx-health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }
    
    # Welcome page (same as HTTP)
    location / {
        return 200 '
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker WebStack</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'%3E%3Ctext y=\'.9em\' font-size=\'90\'%3Eüê≥%3C/text%3E%3C/svg%3E">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Color Emoji", sans-serif; 
            margin: 50px; 
            background: #f4f4f4; 
        }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        .php-versions { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .php-version { background: #007acc; color: white; padding: 15px; border-radius: 5px; text-align: center; }
        .services { margin: 20px 0; }
        .service { background: #28a745; color: white; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .info { background: #17a2b8; color: white; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .emoji { font-size: 1.2em; }
    </style>
</head>
<body>
    <div class="container">
        <h1><span class="emoji">üê≥</span> Docker WebStack Multi-PHP Environment</h1>
        
        <div class="info">
            <strong>Stack Ready!</strong> LEMP Stack dengan Multi-PHP, MariaDB Replication, Redis, dan tools lengkap.
        </div>
        
        <h2><span class="emoji">üìã</span> Available Services</h2>
        <div class="services">
            <div class="service"><span class="emoji">üêò</span> MariaDB Master/Slave Replication - Port 3306/3307</div>
            <div class="service"><span class="emoji">üî¥</span> Redis Cache Server - Port 6379</div>
            <div class="service"><span class="emoji">üìä</span> Redis Commander - <a href="http://localhost:8082" style="color: white;">http://localhost:8082</a></div>
        </div>
        
       
        
        <h2><span class="emoji">üìÅ</span> Project Structure</h2>
        <p>Place your projects in <code>/projects/</code> directory with project-specific nginx.conf for custom PHP routing.</p>
        <p>Use hostname patterns like <code>php74.localhost</code> or <code>php83.example.com</code> to route to specific PHP versions.</p>
        
        <div class="info">
            <strong>Need Help?</strong> Check AGENT.md and README.md for commands and documentation.
        </div>
    </div>
</body>
</html>
        ';
        add_header Content-Type text/html;
    }
}

# Include project-specific HTTPS configurations
include /var/www/projects/*/nginx-ssl.conf;
